<?xml version="1.0" encoding="UTF-8"?>

<!-- This file is part of the book                -->
<!--                                              -->
<!--      A Modeling Approach to Calculus         -->
<!--                                              -->
<!-- Copyright (C) 2015  D. Brian Walton          -->
<!-- See the file COPYING for copying conditions. -->

<section xml:id="ftc-part-one">
  <title>The Fundamental Theorem of Calculus, Part One</title>
  <subsection>
    <title>Overview</title>
    <p>
      When we introduced the definite integral, we also learned about accumulation functions.
      An <xref ref='defn-accumulation-function' text='title'>accumulation function</xref> is a function <m>A</m>
      defined as a definite integral from a fixed lower limit <m>a</m> to a variable upper limit
      where the integrand is a given function <m>f</m>,
      <me>A(x) = A(a) + \int_a^x f(z)\, dz</me>.
      The function <m>f</m> was called the rate of accumulation for the function <m>A</m>,
      and we wrote <m>A'(x) = f(x)</m>.
      Then we defined another rate of change, the instantaneous rate of change,
      with a corresponding function called <xref ref="defn-derivative" text="title">the derivative</xref>.
      For a function <m>F(x)</m>, the derivative was defined by a limit,
      <me>\frac{dF}{dx}(x) = \lim_{h \to 0} \frac{F(x+h)-F(x)}{h}</me>.
    </p>
    <p>
      This section establishes a relation between these two concepts of the rate of change.
      The Fundamental Theorem of Calculus proves that the derivative of an accumulation function
      exactly matches the rate of accumulation at whenever the rate of accumulation is continuous.
      That is, the instantaneous rate of change of a quantity,
      which graphically gives the slope of the tangent line on the graph,
      is exactly the same as the value of the rate of accumulation
      when the function is expressed as an accumulation using a definite integral.
      The proof of the fundamental theorem relies on properties of continuous functions
      as well as properties of limits.
    </p>
  </subsection>
  <subsection>
    <title>Illustration of an Example</title>
    <p>
      To illustrate the concept that we will prove, let us consider a simple polynomial function
      <me>f(x) = x^3 - 3x + 5</me>.
      Using our rules of accumulation, we know that <m>f(x)</m> can be written as an accumulation,
      <me>f(x) = 5 + \int_0^x 3z^2-3 \, dz</me>.
      What happens if we compute the <xref ref="defn-derivative" text="title">derivative using the definition</xref>?
    </p>
    <p>
      We start with some preparatory algebra based on <m>f(x) = x^3-3x+5</m>.
      <md>
        <mrow>f(x+h)&amp;= (x+h)^3 - 3(x+h)+5</mrow>
        <mrow> &amp;= (x+h)(x+h)(x+h) - 3(x+h) + 5</mrow>
        <mrow> &amp;= (x^2+2xh+h^2)(x+h) - 3x - 3h + 5</mrow>
        <mrow> &amp;= x^3+3x^2h + 3xh^2 + h^3 - 3x - 3h + 5</mrow>
      </md>
      <md>
        <mrow>f(x+h) - f(x) &amp;= (x^3 + 3x^2h + 3xh^2 + h^3 - 3x - 3h + 5) - (x^3 - 3x + 5)</mrow>
        <mrow> &amp;= 3x^2h + 3xh^2 + h^3 - 3h</mrow>
        <mrow> &amp;= h(3x^2+3xh+h^2-3)</mrow>
      </md>
      The derivative can be computed using the limit:
      <md>
        <mrow> \frac{df}{dx}(x) &amp;= \lim_{h \to 0} \frac{f(x+h)-f(x)}{h} </mrow>
        <mrow> &amp; = \lim_{h \to 0} \frac{h(3x^2+3xh+h^2-3)}{h} </mrow>
        <mrow> &amp; = \lim_{h \to 0} 3x^2+3xh+h^2-3 </mrow>
        <mrow> &amp; = 3x^2+3x(0)+(0)^2-3 </mrow>
        <mrow> &amp; = 3x^2-3 </mrow>.
      </md>
      The derivative exactly matches the rate of accumulation.
    </p>
  </subsection>
  <subsection>
    <title>Average Value of a Function</title>
    <p>
      The derivative computes the limit of the average rate of change.
      In preparation for the Fundamental Theorem of Calculus,
      we need a relation between the idea of average value and the definite integral.
    </p>
    <p>
      Consider how we compute the average value of a list of numbers.
      We add up all the values and divide by the number of values in the list.
      When thinking about a function <m>f</m> on an interval <m>[a,b]</m>,
      there are infinitely many different values to consider.
      We need a different way to think about it.
      We define the average value of a function using a limit of a standard average value.
    </p>
    <p>
      Let <m>f</m> be a piecewise continuous function on <m>[a,b]</m>
      so that the definite integral <m>\displaystyle \int_a^b f(x) \,dx</m> will be defined.
      Consider a uniform partition of the interval <m>[a,b]</m> with
      <m>\Delta x = \frac{b-a}{n}</m> and <m>x_k = a + k \cdot \Delta x</m>,
      just as we defined when creating a Riemann sum.
      We <em>approximate</em> the average value of <m>f</m> on the interval <m>[a,b]</m>,
      which is represented by the symbol <m>\langle f \rangle_{[a,b]}</m>,
      by finding the average of the values <m>f(x_k)</m> for <m>k=1,2,\ldots,n</m>:
      <me> \langle f \rangle_{[a,b]} \approx \frac{1}{n} \sum_{k=1}^{n} f(x_k) </me>.
      The approximation is improved with larger and larger values of <m>n</m>,
      so the actual average value will be the limit of the average as <m>n \to \infty</m>:
      <me> \langle f \rangle_{[a,b]} = \lim_{n \to \infty} \frac{1}{n} \sum_{k=1}^{n} f(x_k) </me>.
    </p>
    <p>
      The average value defined by this limit looks remarkably similar
      to the limit of a Riemann sum that would define a definite integral.
      In particular,
      <me> \int_a^b f(x) \, dx = \lim_{n \to \infty} \sum_{k=1}^{n} f(x_k) \frac{b-a}{n}</me>.
      Comparing our two limits reveals that the definite integral is the same as the average value multiplied by <m>b-a</m>.
      This will be our formal definition of the average value of a function.
    </p>
    <definition xml:id="defn-function-average-value">
      <statement>
        <p>
          For a function <m>f</m> which has an integral on an interval <m>[a,b]</m>,
          the <term>average value</term> of <m>f</m> on <m>[a,b]</m> is defined by
          <me> \langle f \rangle_{[a,b]} = \frac{1}{b-a} \int_{a}^{b} f(x) \, dx </me>.
        </p>
      </statement>
    </definition>
    <p>
      When we think of the definite integral as the total signed area between the graph <m>y=f(x)</m> and the axis <m>y=0</m>,
      the average value can be interpreted as the value of a constant function that would have the same signed area.
      Imagine the area below the graph <m>y=f(x)</m> as if it were frozen in place like ice.
      If we melt the ice and use the vertical lines <m>x=a</m> and <m>x=b</m> as barriers,
      the high points in the water would fill the valleys until the water is flat.
      The resulting flat value is equivalent to the average value of the original function.
      Any regions of area above the average value line are used to exactly fill in an equivalent amount of area missing below the line.
    </p>
    <example>
      <statement>
        <p>
          Compute the average value of <m>f(x)=x^2-2</m> on the interval <m>[0,2]</m>.
          Then create a graph comparing <m>y=f(x)</m> with <m>y=\langle x^2 \rangle_{[0,2]}</m>.
        </p>
      </statement>
      <solution>
        <p>
          The average value is computed by dividing the definite integral of <m>f(x)=x^2-2</m> as <m>x</m> goes from 0 to 2
          by the length of the interval.
          <md>
            <mrow>\langle x^2 \rangle_{[0,2]} &amp;= \frac{1}{2-0} \int_0^2 x^2 - 2 \, dx </mrow>
            <mrow> &amp;= \frac{1}{2} \Big[ \frac{1}{3}x^3 - 2x \Big]_0^2 </mrow>
            <mrow> &amp;= \frac{1}{2} \Big(\frac{8}{3} - 2(2)\Big) - \frac{1}{2} \Big(\frac{0}{3} - 2(0)\Big) </mrow>
            <mrow> &amp;= \frac{1}{2} \Big(\frac{-4}{3}\Big) = -\frac{2}{3} </mrow>
          </md>
          If we graph <m>y=x^2-2</m> and <m>y=-\frac{2}{3}</m>,
          we should see that the area above the average value is matched by missing area below average,
          as shown in the graph below.
        </p>
        <sidebyside width="50%">
          <image>
            <latex-image>
              \begin{tikzpicture}
              \begin{axis}
              [
                xmin=-3, xmax=3, ymin=-4, ymax=4,
                axis lines = center, xlabel = {$x$}, ylabel={$y$},
              ]
              \addplot [ domain=-3:3, thick, blue ] {x^2-2};
              \addplot [ name path=curve, domain=0:2, samples=50, thick, blue ] {x^2-2};
              \addplot [ name path=average, domain=0:2, samples=50, thick, red ] {-2/3};
              \addplot fill between[
                of = curve and average,
                split, % calculate segments
                every even segment/.style = {orange!30},
                every odd segment/.style  = {blue!30}
              ];
              \end{axis}
              \end{tikzpicture}
            </latex-image>
          </image>
        </sidebyside>
      </solution>
    </example>
    <p>
      Now, are you ready to be blown away?
      Let's think about an accumulation function, <m>A</m> with rate of accumulation <m>A'</m>.
      What is the average rate of change of <m>A(x)</m> as <m>x</m> goes from <m>a</m> to <m>b</m>?
      <me> \frac{\Delta A}{\Delta x}\Big|_{a,b} = \frac{A(b)-A(a)}{b-a} = \frac{1}{b-a} \left(A(b)-A(a)\right) </me>.
      Because <m>A</m> is an accumulation, the change <m>\Delta A</m> can be rewritten using an integral and
      <me> \frac{\Delta A}{\Delta x}\Big|_{a,b} = \frac{1}{b-a} \int_a^b A'(x) \,dx </me>.
      But that is just the average value of the rate of accumulation function <m>A'</m>.
      Two completely different ideas of average value end up measuring the very same thing.
    </p>
    <theorem xml:id="thm-average-value-equivalence">
      <statement>
        <p>
          The average rate of change (the difference quotient) of an accumulation function <m>A(x)</m> is exactly equal
          to the average value (the integral divided by interval length) of the corresponding rate of accumulation <m>A'(x)</m>:
          <me> \frac{\Delta A}{\Delta x}\Big|_{a,b} = \langle A' \rangle_{[a,b]}</me>.
        </p>
      </statement>
    </theorem>

  </subsection>
  <subsection>
    <title>The Fundamental Theorem</title>
    <theorem xml:id='theorem-ftc-part-one'>
      <title>The Fundamental Theorem of Calculus, Part One (FTC1)</title>
      <statement>
        <p>
          Given any function <m>f(x)</m> that is continuous on an interval <m>I</m> and a value <m>a \in I</m>.
          The accumulation function <me>A(x) = \int_{a}^{x} f(z) \, dz</me> is differentiable
          and <m>\frac{dA}{dx}(x) = f(x)</m> for all <m>x \in I</m>.
        </p>
      </statement>
      <proof>
        <p>
          The proof relies on the <xref ref='mean-value-theorem-integral' text='title'>Mean Value Theorem for Integrals</xref>.
          Given the accumulation function <m>A(x)</m> and its associated integrand <m>f(x)</m>,
          we focus on the <xref ref='defn-derivative' text='title'>definition of the derivative</xref> for <m>A(x)</m>:
          <me>\frac{dA}{dx}(x) = \lim_{h \to 0} \frac{A(x+h)-A(x)}{h}.</me>
          We use the splitting property of definite integrals to rewrite this as
          <me>\frac{dA}{dx}(x) = \lim_{h \to 0} \frac{1}{h} \int_x^{x+h} f(z) \, dz.</me>
          Because the function inside the limit is an average value of <m>f</m> on the interval from <m>x</m> to <m>x+h</m> and <m>f</m> is continuous,
          the mean value theorem allows us to replace that formula with the value of <m>f</m> at some point <m>c</m> between <m>x</m> and <m>x+h</m>,
          and we treat <m>c</m> as a function of <m>h</m>:
          <me>A'(x) = \lim_{h \to 0} f(c(h)). </me>
          As <m>h \to 0</m>, since <m>c</m> is constrained to be between <m>x</m> and <m>x+h</m>,
          we know <m>c \to x</m> and continuity allows us to conclude
          <me> A'(x) = \lim_{h \to 0} f(c(h)) = f(x). </me>
        </p>
      </proof>
    </theorem>
  </subsection>
</section>
