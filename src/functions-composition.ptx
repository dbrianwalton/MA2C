<?xml version="1.0" encoding="UTF-8"?>

<!-- This file is part of the book                -->
<!--                                              -->
<!--      A Modeling Approach to Calculus         -->
<!--                                              -->
<!-- Copyright (C) 2017-2019  D. Brian Walton     -->
<!-- See the file COPYING for copying conditions. -->
<section xml:id="functions-composition">
  <title>Chains and Function Composition</title>
  <introduction>
    <title>Overview</title>
    <p>
      When we studied how formulas are constructed, we introduced the idea of function composition.
      Composition occurs whenever a function uses an expression rather than a simple variable as its input.
      In this section, we study the application of composition in terms of creating a chain of relationships between dependent variables.
      Given a complex formula that involves composition, we will learn to identify these chains.
      We will also consider applications of chains using formulas, graphs, and tables.
    </p>
  </introduction>
  <subsection>
    <title>Composition and Chains of Relationships</title>
    <p>
      An algebraic formula typically contains many different operations.
      If the formula involves a single variable, then that formula could be used to define a function.
      The function is the map that takes a value for the variable as its input and returns the value of the expression as the output.
      We could think of the function as a new operation;
      the formula provides the detailed instructions on how to perform that operation.
    </p>
    <p>
      Composition occurs whenever the output of one function acts as the input to another function.
      For example, <m>f(x) = (\ln(x))^2</m> takes the value of <m>x</m>, uses that as the input to <m>\ln</m>, the natural logarithm, and then squares the result.
      This is a composition of the logarithm function with the squaring function.
      If we introduced the power function <m>\mathrm{pow}_2(x) = x^2</m>, then the expression could be rewritten
      <me>( \ln(x) )^2 = \mathrm{pow}_2\big( \ln(x) \big)</me>.
      The parentheses of function notation illustrate that the expression <m>\ln(x)</m> acts as input to the <m>\mathrm{pow}_2</m> function.
    </p>
    <p>
      Because a function should be interpreted as a map between an independent variable and a dependent variable,
      we can think of function composition as a chain of relationships between more than two variables.
      In our working example, suppose we introduce the dependent variable <m>y = (\ln(x))^2</m>.
      The calculation involves two steps: first we compute the logarithm, then we square the result.
      The result of that first operation is an intermediate variable, most commonly chosen as <m>u</m>,
      and we say <m>u = \ln(x)</m>.
      The final operation is an action applied to <m>u</m>, namely <m>y = u^2</m>.
      The chain of relationships could be expressed as the system of equations
      <me>
        \begin{cases}
        u = \ln(x), \\
        y = u^2.
        \end{cases}
      </me>
      The logarithm is used as the map <m>x \overset{\ln}{\mapsto} u</m> while the squaring function is the map <m>u \overset{\mathrm{pow}_2}{\mapsto} y</m>.
      The overall calculation <m>f(x) = (\ln(x))^2</m> provides the map <m>x \overset{f}{\mapsto} y</m>.
    </p>
    <p>
      When functions used in a composition are named, a composition operation is represented by a small circle between their names.
      For our example, we would have <m>f(x) = \mathrm{pow}_2 \circ \ln (x)</m>.
      Because the convention for function notation places the input on the right of the function name (and inside parentheses),
      the function name on the right of the circle is the inner function that defines the intermediate variable.
      The function name on the left of the circle is the outer function that completes the calculation.
    </p>
    <p>
      Many formulas can be interpreted as compositions.
      To identify a composition, you need to be able to identify that the calculation performs some action on the result of an intermediate expression.
      However, you need to be careful that you are not using the original independent variable except in the intermediate expression.
      The intermediate expression itself can appear multiple times.
      It is often helpful to try to write down a chain of variables to represent the composition.
      Start by identifying the intermediate expression and assign it to some intermediate variable, such as <m>u</m>.
      This defines the inner function.
      Then try to write the original expression only in terms of the new variable,
      substituting every instance of the intermediate expression by your variable.
      The resulting expression is the outer function.
    </p>
    <example>
      <statement>
        <p>
          Express <m>\displaystyle y = \frac{2}{3(x-2)^2+1}</m> as a composition.
        </p>
      </statement>
      <solution>
        <p>
          There are multiple ways we could express our relation as a composition.
          We can interpret the order of operations as a sequence of operations acting on the original input <m>x</m>.
          <ol>
            <li>Take <m>x</m>.</li>
            <li>Take the value and subtract 2.</li>
            <li>Square the result.</li>
            <li>Multiply the result by 3.</li>
            <li>Take the result and add 1.</li>
            <li>Divide 2 by the result.</li>
          </ol>
          Because each step in the operation takes the result of all prior steps,
          we could define the intermediate expression after any of the operations.
        </p>
        <p>
          Suppose we define the intermediate operation to be all of the steps through squaring the result.
          Our intermediate variable defines our inner function,
          <me>u = g(x) = (x-2)^2</me>.
          The remaining steps in our description describe the outer function.
          <ol>
            <li>Take <m>u</m>.</li>
            <li>Multiply the value by 3.</li>
            <li>Take the result and add 1.</li>
            <li>Divide 2 by the result.</li>
          </ol>
          As an equation, this becomes
          <me>y = h(u) = \frac{2}{3u+1}</me>,
          which exactly corresponds to replacing the expression <m>(x-2)^2</m> in the original equation with the intermediate variable <m>u</m>.
          The composition defines the equation
          <me>y = h \circ g(x)</me>.
        </p>
        <p>
          Choosing a different expression for our intermediate variable results in a different choice for the composition.
          For example, if we had chosen an inner function to be
          <me>u = p(x) = x-2</me>,
          then the outer function would need to be
          <me>y = r(u) = \frac{2}{3u^2+1}</me>.
          Thus, we also have <m>y = r \circ p(x)</m>.
          Similarly, if we had chosen
          <me>u = Q(x) = 3(x-2)^2+1</me>
          then our outer function would be
          <me>y = S(u) = \frac{2}{u}</me>
          to give <m>y = S \circ Q(x)</m>.
        </p>
      </solution>
    </example>
    <p>
      Did you ever have to learn about an algebra topic <term>completing the square</term>?
      If so, did you find yourself asking the question <q>Why are we doing this?</q>
      One answer could be that a quadratic expression is not written in a way that it can be interpreted as a composition,
      but after completing the square it is.
    </p>
    <example>
      <statement>
        <p>
          Consider the expression <m>x^2+6x-3</m>.
          The expression is not a composition because it involves addition of two unrelated terms that involve the variable <m>x</m>.
          Completing the square is a strategy where the expression involving only the <m>x^2</m> and <m>x</m> terms is recognized
          as matching the corresponding terms of a squared binomial term.
          In this case, because <m>6 \div 2 = 3</m>, we see that <m>x^2+6x-3</m> has the same <m>x^2</m> and <m>x</m> terms
          as <m>(x+3)^2 = x^2 + 6x + 9</m>.
          Consequently, because we now know that
          <me>x^2 + 6x = (x+3)^2 - 9</me>,
          we can write
          <me>x^2+6x-3 = (x+3)^2 - 12</me>.
          This new representation expresses our quadratic as the composition of three simple operations: adding 3, squaring, and subtracting 12.
        </p>
      </statement>
    </example>
    <p>
      When we are given two functions and compute their composition, we use substitution to simplify our work.
      It is important to think about inputs and outputs of functions.
      Function notation is about substitution, using whatever expression appears as the input in place of the independent variable.
      Be careful that you don't think about multiplying by a function<mdash/>we <em>apply</em> a function.
      Otherwise, you are liable to make algebra errors.
    </p>
    <example>
      <statement>
        <p>
          Suppose <m>f(x) = 2x^2-1</m> and <m>g(x) = 2x+5</m>.
          Compute <m>f \circ g(x)</m> and <m>g \circ f(x)</m>.
        </p>
      </statement>
      <solution>
        <p>
          Because function notation has the input on the right,
          composition places the inner function to the right and the outer function to the left.
          We start with <m>f \circ g(x) = f\big( g(x) \big)</m>.
          Using the idea of a chain, we have an intermediate variable <m>u = g(x) = 2x+5</m>.
          The composition asks for <m>f(u) = 2u^2-1</m>, substituting the independent variable with <m>u</m>.
          When we substitute the inner function in place of <m>u</m>, we get
          <me>f \circ g(x) = f(u) = 2(2x+5)^2 - 1</me>.
          Notice how the expression replacing <m>u</m> is placed inside parentheses.
        </p>
        <p>
          Next, we find <m>g \circ f(x)</m>.
          We now have an intermediate variable <m>u = f(x) = 2x^2-1</m>.
          The outer function then compute <m>g(u) = 2u+5</m>.
          Using substitution, this gives
          <me>g \circ f(x) = g(u) = 2(2x^2-1) + 5</me>.
        </p>
        <p>
          Once we have our expression using substitution, we could expand and simplify the results:
          <md>
            <mrow> f \circ g(x) \amp= 2(2x+5)^2 - 1 = 8x^2 + 40x + 49 </mrow>
            <mrow> g \circ f(x) \amp= 2(2x^2-1)+5 = 4x^2+1 </mrow>
          </md>
          This example should make it clear that the order of composition is important.
        </p>
      </solution>
    </example>
  </subsection>
  <subsection>
    <title>Linking Maps through Chains</title>
    <p>
      Composition corresponds to linking functions together, with the output of one function becoming the input to another function.
      In the context of a physical system, we are considering where the state involves multiple variables, say <m>(A,B,C,\ldots)</m>.
      Suppose we know one function, <m>f: A \mapsto B</m>, that determines the value of <m>B</m> knowing the value of <m>A</m>.
      Then suppose know another function, <m>g: B \mapsto C</m>, that predicts the value of <m>C</m> from the value of <m>B</m>.
      If we link these together in a chain, we can start with a value of <m>A</m>, compute the value of <m>B=f(A)</m>,
      and then use that value of <m>B</m> to compute the value of <m>C=g(B)</m>.
      Together, this composition creates a map <m>g \circ f : A \mapsto C</m>.
      Using substitution, we have <m>C= g\big(f(A)\big)</m>, the output of <m>f</m> becoming the input to <m>g</m>.
    </p>
    <sidebyside width="70%">
      <image>
        <latex-image>
        <![CDATA[\tikzset{%
        }
        \begin{tikzpicture}
        \draw[<->] (0,0) -- (8,0) node[pos=0, left] {$A$};
        \draw (2,0.1) -- (2,-0.1) node[pos=0, above] {$a$};
        \draw[<->] (0,-1.25) -- (8,-1.25) node[pos=0, left] {$B$};
        \draw (4,-1.15) -- (4,-1.35) node[pos=0, above] {$b$};
        \draw [->] (2,-0.15) -- (4,-1) node [pos=0.5, right] {$f$};
        \draw[<->] (0,-2.5) -- (8,-2.5) node[pos=0, left] {$C$};
        \draw (5,-2.4) -- (5,-2.6) node[pos=0, above] {$c$};
        \draw [->] (4,-1.4) -- (5,-2.25) node [pos=0.5, right] {$g$};
        \end{tikzpicture}]]>
        </latex-image>
      </image>
    </sidebyside>
    <p>
      The following dynamic figure allows us to explore how composition links two functions together in a chain.
      The first (inner) function or map is <m>g: x \mapsto u = x+3</m>.
      The second (outer) function is <m>f: u \mapsto y = u^2</m>.
      As you change the value of the input <m>x</m>, you can see where the functions map.
      The combined action <m>f \circ g(x) = (x+3)^2</m> represents a single function that is the composition of the steps.
    </p>
    <figure>
      <caption><m>f \circ g(x) = (x+3)^2</m></caption>
      <jsxgraph xml:id="jsx-fcn-intro-chain-ex1" width="75%" aspect="4:2">
        <input>
        var jcm1 = {
          outer : function(u) { var y; y=u*u; return y; },
          inner : function(x) { var u; u=x+3; return u; },
          input : { name:'x', color:'blue', value:-1 },
          middle : { name:'u', color:'orange'},
          output : { name:'y', color:'red' },
        };
        createChainMap(jcm1, 'jsx-fcn-intro-chain-ex1');
        </input>
      </jsxgraph>
    </figure>
    <p>
      In the preceding subsection, we looked at composition in terms of formulas.
      Maps between variables can also be represented in tables and graphs.
      We can interpret composition by thinking through the relations between variables as we work through the linked maps.
    </p>
    <example>
      <statement>
        <p>
          Suppose <m>f</m> and <m>g</m> are functions defined (at least partially) according to the following table.
          Find each of the following values.
          <ol>
            <li><m>f \circ g(2)</m></li>
            <li><m>g \circ f(2)</m></li>
            <li><m>f \circ f(4)</m></li>
            <li><m>g \circ g(0)</m></li>
          </ol>
        </p>
        <sidebyside widths="40% 40%">
          <tabular>
            <col halign="center" right="major"/>
            <col halign="center" right="major"/>
            <col halign="center" right="major"/>
            <row bottom="major">
              <cell><m>x</m></cell> <cell><m>f(x)</m></cell> <cell><m>g(x)</m></cell>
            </row>
            <row> <cell>-4</cell> <cell>2</cell> <cell>4</cell> </row>
            <row> <cell>-3</cell> <cell>3</cell> <cell>1</cell> </row>
            <row> <cell>-2</cell> <cell>2</cell> <cell>-1</cell> </row>
            <row> <cell>-1</cell> <cell>1</cell> <cell>-2</cell> </row>
            <row> <cell>0</cell> <cell>0</cell> <cell>-3</cell> </row>
            <row> <cell>1</cell> <cell>-1</cell> <cell>0</cell> </row>
            <row> <cell>2</cell> <cell>-2</cell> <cell>2</cell> </row>
            <row> <cell>3</cell> <cell>-3</cell> <cell>3</cell> </row>
            <row> <cell>4</cell> <cell>-2</cell> <cell>4</cell> </row>
          </tabular>
        </sidebyside>
      </statement>
      <solution>
        <p>
          When evaluating a function with the table, notice that the columns for <m>f(x)</m> and <m>g(x)</m> use an independent variable <m>x</m>.
          This means that we will find the input value in the <m>x</m> column and then find the corresponding out value in the function's column.
          <ol>
            <li>
              <p>
                To find <m>f \circ g(2)</m>, we expand the substitution <m>f \circ g(2) = f \big( g(2) \big)</m>.
                The inner function is evaluated first to find <m>g(2) = 2</m>.
                That is, we find <m>2</m> in the column for <m>x</m> (placeholder for the input),
                and looking in the column of <m>g(x)</m> we find 2 as the output.
                This output is used in the chain linking the function as the input for <m>f</m>,
                <me>f\big( g(2) \big) = f(2) = -2</me>.
              </p>
            </li>
            <li>
              <p>
                To find <m>g \circ f(2)</m>, we will expand <m>g \circ f(2) = g \big( f(2) \big)</m>.
                We start with the inner function <m>f(2) = -2</m>.
                We then use the output as the input of the outer function, <m>g(-2) = -1</m>.
                Consequently,
                <me>g\big( f(2) \big) = g(-2) = -1</me>.
              </p>
            </li>
            <li>
              <p>
                Continuing this pattern, we have
                <me>f \circ f(4) = f \big( f(4) \big) = f(-2) = 2</me>.
              </p>
            </li>
            <li>
              <p>
                Similarly, we have
                <me>g \circ g(0) = g \big( g(0) \big) = g(-3) = 1</me>.
              </p>
            </li>
          </ol>
        </p>
      </solution>
    </example>
    <example>
      <statement>
        <p>
          Suppose <m>f</m> and <m>g</m> are functions with graphs as shown below.
          Find each of the following values.
          <ol>
            <li><m>f \circ g(2)</m></li>
            <li><m>g \circ f(2)</m></li>
            <li><m>f \circ f(2)</m></li>
            <li><m>f \circ g \circ g(0)</m></li>
          </ol>
        </p>
        <sidebyside widths="45% 45%">
          <image>
            <description>Graph of y=f(x)</description>
            <latex-image>
              \begin{tikzpicture}
              \begin{axis}
              [
                xmin=-4, xmax=4, ymin=-4, ymax=4,
                grid=both, axis lines = center, minor tick num=1,
                xlabel={$x$}, ylabel={$y=f(x)$},
              ]
              \addplot [domain=-4:4, samples=100, thick, blue] { (x^3-7*x)/2 };
              \end{axis}
              \end{tikzpicture}
            </latex-image>
          </image>
          <image>
            <description>Graph of y=g(x)</description>
            <latex-image>
              \begin{tikzpicture}
              \begin{axis}
              [
                xmin=-4, xmax=4, ymin=-4, ymax=4,
                grid=both, axis lines = center, minor tick num=1,
                xlabel={$x$}, ylabel={$y=g(x)$},
              ]
              \addplot [domain=-4:0, thick, orange] { -x };
              \addplot [domain=0:1, thick, orange] { 2 };
              \addplot [domain=1:4, thick, orange] { x-3 };
              \addplot [ only marks, orange, thick, fill=white ] coordinates
              { (0,0) (0,2) (1,-2) };
              \addplot [ only marks, orange, thick ] coordinates
              { (0,1) (1,2) };
              \end{axis}
              \end{tikzpicture}
            </latex-image>
          </image>
        </sidebyside>
      </statement>
      <solution>
        <p>
          To evaluate a function when given a graph, we find the value of the input along the <m>x</m>-axis.
          This is analogous to looking in the column of <m>x</m> in a function's table.
          Once we find the <m>x</m>-value, we imagine a vertical line at that point
          and find the point that is included in the graph that intersects our line.
          If there is no point included in the graph, then the value of <m>x</m> is not in the domain.
          For composition, we will use the original input to evaluate the inner function.
          Once we know the output value, we will use that result when we evalute the outer function.
          <ol>
            <li>
              <p>
                To evaluate <m>f \circ g(2) = f\big( g(2) \big)</m>, we evaluate <m>g(2)</m> using the graph on the right.
                The vertical line at <m>x=2</m> intersects our graph at the point <m>(2,-1)</m>, so we have <m>g(2)=-1</m>.
                Using that output as the input of <m>f</m>, we find <m>x=-1</m> on the <m>x</m>-axis of the graph on the left.
                The vertical line intersects that graph at <m>(-1,3)</m> so that <m>f(-1)=3</m>.
                Putting this together gives
                <me>f\big( g(2) \big) = f(-1) = 3</me>.
              </p>
            </li>
            <li>
              <p>
                When we evaluate <m>g \circ f(2)</m>, we repeat the process but with <m>f</m> as the inner function and <m>g</m> as the outer function.
                <me>g \circ f(2) = g\big( f(2) \big) = g(-3) = 3</me>.
              </p>
            </li>
            <li>
              <p>
                When we evaluate <m>f \circ f(2)</m>, the same function is used as the inner and outer function.
                This means that when we find the output <m>f(2) = -3</m>, we use the same function to evaluate <m>f(-3)=-3</m>.
                Consequently, we have
                <me>f \circ f(2) = f\big( f(2) \big) = f(-3) = -3</me>.
              </p>
            </li>
            <li>
              <p>
                When an expression has more than one composition, we proceed through the chain from the inside out.
                The expression <m>f \circ g \circ g(0)</m> has an innermost function <m>g</m>.
                The vertical line <m>x=0</m> intersections the graph of <m>g</m> at the point <m>(0,1)</m>.
                The open points at <m>(0,0)</m> and <m>(0,2)</m> represent end-points of the graph segments
                immediately to the left and to the right of the point but are not included as actual points.
                Consequently, <m>g(0) = 1</m> which is now the input of the next <m>g</m> operation.
                We have
                <me>f \circ g \circ g(0) = f \circ g(1) = f(2) = -3</me>.
              </p>
            </li>
          </ol>
        </p>
      </solution>
    </example>
  </subsection>
  <subsection>
    <title>Applications of Composition</title>
    <p>
      In modeling settings, composition arises in the context of chains of related variables.
      Whenever we model relationships between variables, we ideally create functions to describe these relations.
      A chain occurs when we know a relation between, say, <m>A</m> and <m>B</m> and another relation between <m>B</m> and <m>C</m>.
      Each of these relations might be based on observations or experiments.
      The chain allows us to identify a relation between <m>A</m> and <m>C</m>, even if a direct observation or experiment is not possible or convenient.
    </p>
    <example>
      <statement>
        <p>
          The radius <m>r</m>, circumference <m>C</m>, and area <m>A</m> of a circle are all related.
          The equation <m>C=2 \pi r</m> defines <m>C</m> as a function of <m>r</m>
          and the equation <m>A = \pi r^2</m> defines <m>A</m> as a function of <m>r</m>.
          Use composition to define the function <m>C \mapsto A</m>.
        </p>
      </statement>
      <solution>
        <p>
          The final output should be area <m>A</m>, which we can compute if we know <m>r</m>.
          We can use the relation between <m>C</m> and <m>r</m> to solve for <m>r</m> as a function of <m>C</m>.
          That is, we want to create a composition of <m>C \mapsto r</m> and <m>r \mapsto A</m>.
          <md>
            <mrow>C = 2 \pi r</mrow>
            <mrow>\frac{C}{2 \pi} = r</mrow>
          </md>
          This equation defines <m>C \mapsto r</m>, so that we have a chain
          <md>
            <mrow>r &amp;= \frac{C}{2 \pi},</mrow>
            <mrow>A &amp;= \pi r^2.</mrow>
          </md>
          Composition corresponds to substitution of <m>r</m> by its formula,
          <me>A = \pi r^2 = \pi \Big(\frac{C}{2\pi}\Big)^2 = \frac{\pi C^2}{2^2 \pi^2} = \frac{C^2}{4 \pi}.</me>
        </p>
      </solution>
    </example>
    <example>
      <statement>
        <p>
          Suppose you are blowing up a balloon with air.
          What is the radius of the balloon as a function of time?
        </p>
      </statement>
      <solution>
        <p>
          The question is intentionally somewhat vague in order to illustrate the modeling process.
          Without more information, the question is ill-posed and there is not a clear answer.
          What simplifying assumptions could we make that will allow us to create a reasonable answer?
          <ol>
            <li>What shape is the balloon? We could make a simplifying assumption that it is approximately a sphere.</li>
            <li>
              <p>
                How fast is air being added?
                If we pretend to blow air in a balloon, we can time how long each breath takes.
                With a quick internet search, we can discover the typical amount of air blown per breath.
              </p>
            </li>
            <li>
              <p>
                Keep things steady.
                It adds complications to the process if we try to account for inhaling between breaths or slowing down because we are tired.
                Let us replace human breaths blowing up the balloon with a model that would correspond to steady airflow that matches the average rate of filling.
              </p>
            </li>
          </ol>
        </p>
        <p>
          With our assumptions identified, we can start to establish our model using equations.
          A sphere has a relationship between volume and radius according to the equation <m>V = \frac{4}{3} \pi r^3</m>.
          Because we want the radius <m>r</m> as the final output variable, we need <m>V \mapsto r</m> which we find by solving for <m>r</m>.
          <me>r = \sqrt[3]{\frac{3V}{4 \pi}} = \left( \frac{3V}{4\pi} \right)^{1/3}</me>.
          Our information about filling the balloon will give us a model for <m>t \mapsto V</m>.
          I found a result showing that there is about 1/2 liter of air exhaled in a breath,
          which corresponds to <quantity><mag>500</mag><unit prefix="centi" base="meter" exp="3"/></quantity>.
          With a timer, I approximated that each steady blow takes about 5 seconds, including inhalation to prepare for the next breath.
          This means that the balloon is gaining <quantity><mag>100</mag><unit prefix="centi" base="meter" exp="3"/><per base="second"/></quantity>.
          If air flows at a steady rate, the relation <m>t \mapsto V</m> is linear and starts at <m>V=0</m> when <m>t=0</m>.
          This gives us our second function in the chain,
          <me>V = 100 t</me>.
          The composition of the chain <m>t \mapsto V \mapsto r</m> will give us a model for <m>t \mapsto r</m>,
          which we create using substitution:
          <me> r = \sqrt[3]{\frac{300 t}{4 \pi}} </me>.
        </p>
      </solution>
    </example>
    <p>
      Our examples have included questions where a function was composed with itself.
      This actually occurs in practical settings, such as where a function maps from the value of some quantity to the value of the same quantity at a later time.
    </p>
    <example>
      <statement>
        <p>
          A population's growth and decline depend on how the population size relates to its carrying capacity.
          If the population is below its capacity, then abundance of resources will lead the population to grow.
          If the population is too large, then physical constraints will cause the population to decline.
          Mathematical ecologists study possible behaviors for populations through the use of <term>projection functions</term>.
          A projection function maps the value of the population size at one time to the next observed population size.
          That is, knowing the size of the population this year, a projection function allows us to predict the population size next year.
          Composition of the function with itself then allows us to predict two years away.
        </p>
        <p>
          Suppose the size of a population (in thousands) has been modeled by an annual projection function <m>f(x) = 1.6x - 0.32x^2</m>.
          If the population is currently 400, what will it be next year? in two years?
          What is the function that projects the population size two years from the present?
        </p>
      </statement>
      <solution>
        <p>
          A population of 400 corresponds to a current population value <m>x=0.4</m> (thousands).
          The projection function uses this value to predict one year into the future.
          When we evaluate the function, we find
          <me>f(0.4) = 1.6(0.4)-0.32(0.4)^2 = 0.5888</me>,
          corresponding to a population prediction of 588.8.
          If we use the function again with an input <m>x=0.5888</m>,
          the function will predict one year from next year, or two years away.
          This gives
          <me>f(0.5888) = 1.6(0.5888)-0.32(0.5888)^2 \approx 0.83114</me>.
          The model therefore predicts approximately 589 individuals in one year and 831 individuals the next year.
          (The calculation stays exact; the interpretation rounds.)
        </p>
        <p>
          We found the projected population in two years through composition <m>f \circ f(0.4) \approx 0.83114</m>.
          The process of computation would be the same for any current population value <m>x</m>.
          Consequently, we can create a function that projects the population size in two years
          by computing the composition <m>f \circ f(x)</m> using substitution.
          <md>
            <mrow> f \circ f(x) \amp= f\big( f(x) \big) </mrow>
            <mrow> \amp= f(1.6x-0.32x^2) </mrow>
            <mrow> \amp= 1.6(1.6x-0.32x^2) - 0.32 (1.6x-0.32x^2)^2</mrow>
          </md>
          We have replaced each <m>x</m> in the formula <m>1.6x - 0.32x^2</m> with the expression <m>1.6x - 0.32x^2</m>.
          We can use a computer to help expand and simplify this algebraic formula,
          <me> f \circ f(x) = 2.56 x -1.3312 x^2 + 0.32768 x^3 - 0.032768 x^4 </me>.
        </p>
        <sage>
          <input>
            f(x) = 1.6*x - 0.32*x^2
            show( f(f(x)).expand().simplify() )
          </input>
        </sage>
      </solution>
    </example>
  </subsection>
  <subsection>
    <title>Summary</title>
    <p>
    <ul>
      <li>
        A chain of related variables is
        where knowing <m>A</m> you can predict <m>B</m>,
        and knowing <m>B</m> you can predict <m>C</m>, and so on.
        Composition is using <m>A</m> and the chain to find <m>C</m>.
      </li>
      <li>
        Composition <m>f \circ g</m> is evaluation of the outer function <m>f</m>
        with an input using the output of the inner function <m>g</m>,
        <me>f \circ g(x) = f\big(g(x)\big)</me>.
        As maps, if <m>g:x \mapsto u</m> and <m>f:u \mapsto y</m>, then
        <me>x \overset{f \circ g}\mapsto y \quad = \quad x \overset{g}\mapsto u \overset{f}\mapsto y.</me>
      </li>
    </ul>
    </p>
  </subsection>
  <exercises>
    <exercisegroup>
      <introduction>
        <p>
          Rewrite each function as a nontrivial composition of two functions.
          (Nontrivial means that neither function should be the identify function <m>x \mapsto x</m>.)
        </p>
      </introduction>
      <exercise>
        <statement>
          <p><m>f(x) = (x^2-4x)^5</m></p>
        </statement>
      </exercise>
      <exercise>
        <statement>
          <p><m>f(x) = \sqrt{3x+1}</m></p>
        </statement>
      </exercise>
      <exercise>
        <statement>
          <p><m>f(x) = 4e^{-x^2}</m></p>
        </statement>
      </exercise>
      <exercise>
        <statement>
          <p><m>f(x) = 2 \sin(3x) + 1</m></p>
        </statement>
      </exercise>
      <exercise>
        <statement>
          <p><m>\displaystyle f(x) = \frac{2}{(e^{x}+1)^2}</m></p>
        </statement>
      </exercise>
      <exercise>
        <statement>
          <p><m>\displaystyle f(x) = \sqrt{x} - \frac{3}{\sqrt{x}}</m></p>
        </statement>
      </exercise>
      <exercise>
        <statement>
          <p><m>\displaystyle f(x) = \sin^2(x) + 4 \sin(x) + 3</m></p>
        </statement>
      </exercise>
      <exercise>
        <statement>
          <p><m>\displaystyle f(x) = \frac{e^{x}-e^{-x}}{e^{x}+e^{-x}}</m></p>
        </statement>
      </exercise>
    </exercisegroup>
    <exercisegroup>
      <introduction>
        <p>
          Using the given functions, compute and simplify the expressions listed.
        </p>
      </introduction>
      <exercise>
        <statement>
          <p>
            Given <m>p(x)=x^2-1</m> and <m>r(x)=2x+1</m>.
            <ol>
              <li><m>p \circ r(x)</m></li>
              <li><m>r \circ p(x)</m></li>
              <li><m>p \circ p(x)</m></li>
              <li><m>r \circ r(x)</m></li>
            </ol>
          </p>
        </statement>
      </exercise>
      <exercise>
        <statement>
          <p>
            Given <m>k(x)=e^{x}</m> and <m>h(x)=1-x^2</m>.
            <ol>
              <li><m>k \circ h(x)</m></li>
              <li><m>h \circ k(x)</m></li>
              <li><m>k \circ k(x)</m></li>
            </ol>
          </p>
        </statement>
      </exercise>
      <exercise>
        <statement>
          <p>
            Given <m>\displaystyle C(x)=\frac{2}{x-3}</m> and <m>D(x)=e^{1/x}</m>.
            <ol>
              <li><m>C \circ D(x)</m></li>
              <li><m>D \circ C(x)</m></li>
              <li><m>D \circ D(x)</m></li>
            </ol>
          </p>
        </statement>
      </exercise>
      <exercise>
        <statement>
          <p>
            Given <m>f</m> and <m>g</m> defined by the table below and <m>h(x)=2x-1</m>.
          </p>
          <sidebyside>
            <tabular >
              <col halign="center" right="major"/>
              <col halign="right" />
              <col halign="right" />
              <col halign="right" />
              <col halign="right" />
              <col halign="right" />
              <col halign="right" />
              <col halign="right" />
              <col halign="right" />
              <col halign="right"/>
              <row bottom="major">
                <cell><m>x</m></cell>
                <cell><m>-4</m></cell>
                <cell><m>-3</m></cell>
                <cell><m>-2</m></cell>
                <cell><m>-1</m></cell>
                <cell><m>0</m></cell>
                <cell><m>1</m></cell>
                <cell><m>2</m></cell>
                <cell><m>3</m></cell>
                <cell><m>4</m></cell>
              </row>
              <row bottom="major">
                <cell><m>f(x)</m></cell>
                <cell><m>4</m></cell>
                <cell><m>1</m></cell>
                <cell><m>2</m></cell>
                <cell><m>0</m></cell>
                <cell><m>-2</m></cell>
                <cell><m>3</m></cell>
                <cell><m>-1</m></cell>
                <cell><m>-3</m></cell>
                <cell><m>-4</m></cell>
              </row>
              <row>
                <cell><m>g(x)</m></cell>
                <cell><m>2</m></cell>
                <cell><m>-2</m></cell>
                <cell><m>4</m></cell>
                <cell><m>3</m></cell>
                <cell><m>-3</m></cell>
                <cell><m>-1</m></cell>
                <cell><m>0</m></cell>
                <cell><m>1</m></cell>
                <cell><m>-4</m></cell>
              </row>
            </tabular>
          </sidebyside>
          <p>
            <ol>
              <li><m>f \circ g(2)</m></li>
              <li><m>g \circ f(-2)</m></li>
              <li><m>f \circ f(-2)</m></li>
              <li><m>f \circ h(2)</m></li>
              <li><m>h \circ g(1)</m></li>
            </ol>
          </p>
        </statement>
      </exercise>
      <exercise>
        <statement>
          <p>
            Given <m>f</m> and <m>g</m> defined by the graphs below.
          </p>
          <sidebyside widths="45% 45%">
            <image>
              <description>Graph of y=f(x)</description>
              <latex-image>
                \begin{tikzpicture}
                \begin{axis}
                [
                  xmin=-4, xmax=4, ymin=-4.5, ymax=4.5,
                  grid=both, axis lines = center, minor tick num=1,
                  xlabel={$x$}, ylabel={$y=f(x)$},
                ]
                \addplot [domain=-4:4, samples=100, thick, blue] { 4*sin(180*x/6) };
                \end{axis}
                \end{tikzpicture}
              </latex-image>
            </image>
            <image>
              <description>Graph of y=g(x)</description>
              <latex-image>
                \begin{tikzpicture}
                \begin{axis}
                [
                  xmin=-4, xmax=4, ymin=-4.5, ymax=4.5,
                  grid=both, axis lines = center, minor tick num=1,
                  xlabel={$x$}, ylabel={$y=g(x)$},
                ]
                \addplot [domain=-4:-3, thick, orange] { 1 };
                \addplot [domain=-3:-2, thick, orange] { 4 };
                \addplot [domain=-2:-1, thick, orange] { -2 };
                \addplot [domain=-1:0, thick, orange] { 0 };
                \addplot [domain=0:1, thick, orange] { 2 };
                \addplot [domain=1:2, thick, orange] { 3 };
                \addplot [domain=2:3, thick, orange] { -4 };
                \addplot [domain=3:4, thick, orange] { -1 };
                \addplot [ only marks, orange, thick, fill=white ] coordinates
                { (-3,1) (-2,4) (-1,-2) (0,0) (1,2) (2,3) (3,-4) };
                \addplot [ only marks, orange, thick ] coordinates
                { (-4,1) (-3,4) (-2,-2) (-1,0) (0,2) (1,3) (2,-4) (3,-1) (4,-1) };
                \end{axis}
                \end{tikzpicture}
              </latex-image>
            </image>
          </sidebyside>
          <p>
            <ol>
              <li><m>f \circ g(3)</m></li>
              <li><m>g \circ f(3)</m></li>
              <li><m>f \circ g(1)</m></li>
              <li><m>g \circ f(1)</m></li>
              <li><m>f \circ g(-3.25)</m></li>
              <li><m>g \circ f(-1.25)</m></li>
            </ol>
          </p>
        </statement>
      </exercise>
    </exercisegroup>
    <exercisegroup>
      <introduction>
      <p>Applications</p>
      </introduction>
      <exercise>
        <statement>
          <p>
          The perimeter <m>P</m> and area <m>A</m> of a square are each
          functions of the length of the sides <m>s</m> by <m>P=4s</m> and <m>A=s^2</m>.
          Find perimeter as a function of area, <m>P \mapsto A</m>.
          </p>
        </statement>
      </exercise>
      <exercise>
        <statement>
          <p>
          The volume of a sphere is related to the radius of the sphere
          by the equation <m>V = \frac{4}{3} \pi r^3</m>.
          Suppose the radius is a function of time defined by <m>r = 1+2t</m>.
          Find the volume as a function of time, <m>t \mapsto V</m>.
          </p>
        </statement>
      </exercise>
      <exercise>
        <statement>
          <p>
          The cost <m>C</m> of materials for a project depends on the required area <m>A</m> of materials needed.
          The unit price is <dollar/>3.50 per <quantity><unit base="meter" exp="2"/></quantity>.
          The project involves making two squares, each of them having sides with length <m>s</m> (meters).
          <ol>
            <li>Find <m>A \overset{f}{\mapsto} C</m>.</li>
            <li>Find <m>s \overset{g}{\mapsto} A</m>.</li>
            <li>
              <p>
              Use composition to find <m>s \mapsto C</m>.
              Is this <m>f \circ g</m> or <m>g \circ f</m>?
              </p>
            </li>
            <li>
              <p>
              How much would a project with <m>s=4</m> cost?
              How much area of materials will be required?
              What function is used for each calculation?
              </p>
            </li>
          </ol>
          </p>
        </statement>
      </exercise>
      <exercise>
        <statement>
          <p>
            
          </p>
        </statement>
      </exercise>
    </exercisegroup>
  </exercises>
</section>
